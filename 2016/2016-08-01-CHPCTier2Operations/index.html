<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>WLCG Tier2 Cluster Operations</title>

		<meta name="description" content="An explanation of the components to keep it running">
		<meta name="author" content="Sean Murray/@bazinski">

		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal theme-font-sketch theme-color-cobalt-orange">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>CHPC WLCG Cluster Operations</h1>
					<h3>What is used, where, and why</h3>
					<p>
						<small>Created by <a href="http://bazinski.github.io">Sean Murray</a> / <a href="http://twitter.com/bazinski">@bazinski</a></small>
					</p>
        </section>
        <section>
          <h2> Philosophy ... ;-) </h2>
          The overarching design philosophy here is to absolutely completely minimise the admin overhead. Under pinning this is of course KISS. <br>
          Automate everything as far as possible, remove the humans.<br>
          Commercial software avoidance.<br>
				</section>

				<section>
					<h2>Parts</h2>
          <ul>
          <li>
         Deployment/Configuration.
          </li>
					<li>
				 Monitoring.
					</li>
          <li>
         Issues, when things go wrong and planning.
          </li>
          <li>
          Infrastructure management.
          </li>
          <li>
          AAROC.
          </li>
          </ul>
				</section>

				<section>

					<section>
						<h2>Deployment and Configuration</h2>
					</section>
					<section>
						<h2>Foreman</h2>
						<p>
					<ul>
            <li>The Foreman a tool for complete life cycle systems management tool for provisioning, configuring and monitoring of physical servers or others. </li>
            <li>Foreman has deep integration to configuration management software [Puppet, Chef, Salt, etc. ] </li>
            <li>allowing one to automate repetitive tasks, deploy applications, and manage change to deployed servers.</li>
            <li>Foreman provides comprehensive, auditable interaction facilities including a web frontend, a command line interface, and a robust REST API.</li>
					</ul>
          We deploy and then hand over to puppet. <br>Visit : <a href="http://xcat01.chpc.ac.za">foreman</a>
					</section>
					<section>
						<h2>Puppet</h2>
						<p>Configuration management system for entire systems and more.</p>
            <ul>
              <li>Manage required software</li>
              <li>Manage specific files</li>
              <li>Manage operating system up, firewall, sysctl etc. to ssh, apache, postgresql, motd, and users.</li>
            </ul>
            Github for <a href="http://github.com/AAROC/">AAROC</a> and <a href="http://github.com/chpchep">chpchep</a>
						<br>
					</section>
          <section>
            <h2>Puppet 2</h2>
            Domain Speicific Language
					</section>
          <section>
            <h2>Puppet 2</h2>
					<pre><code class="puppet" data-trim contenteditable>
            node /^gnode-1-\d+\.chpc\.ac\.za$/ inherits hepcompute{
              # perl-time-hires
              # nagios-plugins-perl
                zabbix::userparameters { 'userparameter_sockstat.conf':
                script => 'puppet:///modules/zabbix/userparameter_sockstat.conf',
                script_dir => '/etc/zabbix/zabbix_agentd.d/',
                } 
              }
              </code></pre>
					</section>
          <section>
            <h2>Puppet Hiera</h2>
					<pre><code class="yaml" data-trim contenteditable>
            ---
            :backends:
              - yaml
              :yaml:
                :datadir: "/etc/puppet/environments/%{environment}/hieradata"
                :hierarchy:
                  - "nodes/%{clientcert}"
                  - "hostgroups/%{hostgroup}"
                  - global
                        :yaml:
                :datadir:
					</code></pre>
            Its just a keyvalue store for lookups triggered from puppet.
						<aside class="notes">
							Multiple backends, files, ldap, db, encrypted yaml.. Could have OS then be able to define different package names for example.
						</aside>

					</section>
          <section>
            <h2>Puppet Hiera 2</h2>
                                      <pre><code class="puppet" data-trim contenteditable>
            node "grid-bdii.chpc.ac.za" {
                class { "ntp":
                    servers    => [ 'grid-vobox.chpc.ac.za iburst','foreman01.chpc.ac.za iburst'],
                    autoupdate => true,
                    restrict   => [],
                    enable     => true,
                    } }
					</code></pre>
                                      <pre><code class="puppet" data-trim contenteditable>
            node "grid-bdii.chpc.ac.za" {
                    include ntp
                    } 
					</code></pre>
          the parameters for ntp puppet class are resolved through hiera lookups.
					</section>
          <section>
            <h2>Puppet Hiera 3</h2>
            Then in /etc/...../nodes/grid-bdii.yaml or global.yaml
                                      <pre><code class="yaml" data-trim contenteditable>
classes: ntp
ntp::restrict:
  -
  ntp::autoupdate: false
  ntp::enable: true
  ntp::servers:
    - grid-vobox.chpc.ac.za iburst
    - foreman01.chpc.ac.za iburst

					</code></pre>
					</section>
          <section>
            <h2>Puppet R10k</h2>
            A method of "automatically" mapping various sources of puppet modules/manifests, into ones puppet environments.
					</section>
          <section>
            <h2>Puppet respect</h2>
                unit testing currently in testing (Oh the irony)
					</section>
				</section>
        <section>
          <section>
          <h2> Monitoring </h2>
          <ul>
            <li>SLA</li>
            <li>Indicident response. Is something broken</li>
            <li>Performance analysis. Is something operating out of spec.</li>
            <li>Failure detection. Be informed, preemptively fix, if possible.</li>
            <li>Capacity Planning. Are we running out of resources</li>
          <ul>
          </section>
          <section>
					<ul>
            <li><a href="http://zabbix.com"><img width="45" data-src="http://www.zabbix.com/img/zabbix_logo.png" alt="Zabbix logo" align="bottom"></a>zabbix</li>
            <li><a href="http://grafana.org"><img data-src="http://grafana.org/assets/img/logo_new_transparent_200x48.png" alt="Grafana log" align="bottom"></a>grafana</li>
						<li>racktables</li>
						<li>MONALisa (ALICE)</li>
						<li>SAMS</li>
						<li>ATLAS</li>
						<li>EGI/WLCG</li>
						<li>GOCDB</li>
						<li>REGUS</li>
					</ul>
          </section>
          <section>
            <h2> zabbix </h2>
            open it
          </section>
          <section>
            <h2> grafana </h2>
            open it
          </section>
          <section>
            <h2>MONALisa </h2>
            MONALisa monitoring is used by the ALICE experiment to monitor everything about the offline computing of ALICE from central services at CERN and some satelite
            sites. <br>
            This extends from high level physics simulations to batch system and all the way down to  memory and socket counts on nodes, from the moment the data leaves the daq at P2.
            Each site has its own dedicated MONALisa agent instance in a VOBOX.<br>
            The vobox is also where the jobs are sent into the clusters<br>
            One can register in central services for various alerts.<br>
            DEMO <a href="http://alimonitor.cern.ch/" >MonaLisa.</a>
						<aside class="notes">
						  Go down the left menu.
						</aside>
          </section>
          <section>
            <h2>SAMS </h2>
            Experiment funcational testing and uptime monitoring.<br>
            These results are used for calculations relative to REBUS.

          </section>
          <section>
            <h2>ATLAS </h2>
            They want to migrate away from 3 different storage types and standardise as ALICE on xrootd/eos, so we are the guinea pigs...
          </section>
          <section>
            <h2>WLCG/EGI</h2>
            Worldwide Lhc Computing Grid, European Grid Initiative.

          </section>
          <section>
            <h2>GOCDB</h2>
            Database containing the configuration data of a site, what services are provided, contacts. This is used as a basis of what to test for.<br>
            This is where downtime is scheduled and notifications given.
          </section>
          <section>
            <h2>REBUS</h2>
            Database of pledges for each year for each experiment and site.<br>
            This is the measure against which all sites are measured to see if they deliver on REBUS, their promised resources.
          </section>
        </section>
        <section>
          <section>
          <h2> Issues. </h2>
          <ul> 
            <li>GGUS </li>
            <li>redmine </li>
            <li>github </li>
            <li>slack [AAROC] </li>
          </ul>
          </section>
          <section>
            <h2> GGUS </h2>
            Example email ...
          </section>
          <section>
            <h2> Redmine </h2>
            Project management system. <br>
            Issues per project, universal numbering.<br>
            wiki, documents, files, per project. <br>
            numerous plugins, kanban, scrum, git repositories etc. integrated into one.<br>
            notifcations via mail, slack, irc, etc.<br>
            vm sitting on mon01 <br>
          </section>
          <section>
            <h2> Github </h2>
            git repository for puppet and other code.
          </section>
          <section>
            <h2> slack [AAROC] </h2>
            notifications and communications for all of Africa Arabia.<br>
            Zabbix Notifications and interactions <br>
            Redmine notifications and interactions<br>
          </section>
        </section>

        <section>
          <section>
          <h2>Infrastructure management </h2>
          <h3>Rackables</h3>
            Yet to integrate to Zabbix to have singular authoritive source of information<br>
            Store what is where, what is plugged into what.<br>
            Monitor maintenance contracts. <br>
            Trial install currently on mon01 <br>
            <a href="https://mon01.chpc.ac.za/racktables">Racktables at chpc</a>
          </section>
        </section>
			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>

			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});

		</script>

	</body>
</html>
